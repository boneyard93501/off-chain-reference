
digraph G {
  concentrate=True;
  rankdir=TB;
  node [shape=record];

# Happy path protocol
  0 [label="Start"];
  0->1 [label="Sender"]
  0->10 [label="Sender"];


  subgraph cluster_0 {
  label = "KYC Exchange flow"
  1 [label="SINIT\n|{Sender:|Receiver:}|{{need_kyc}|{none}}"];
  1 -> 2 [ label="Receiver" ];
  1 -> 9002 [ label="Receiver" ];
  2 [label="RSEND\n|{Sender:|Receiver:}|{{need_kyc}|{ready_for_settlement}}"];
  9001 [label="SABORT\n|{Sender:|Receiver:}|{{abort}|{ready_for_settlement}}"];
  9002 [label="RABORT1\n|{Sender:|Receiver:}|{{need_kyc}|{abort}}"];
  2->9001 [label="Sender"]

  }

  3->999;
  999 [label = "On-chain payment"]

  subgraph cluster_1 {
  label = "Simple flow"
  10 [label="SREADY\n|{Sender:|Receiver:}|{{ready_for_settlement}|{none}}"];
  10 -> 9003 [label="Receiver"];
  9003 [label="RABORT2\n|{Sender:|Receiver:}|{{ready_for_settlement}|{abort}}"];
  }

  10 -> 3 [label="Receiver"];

  3 [label="READY\n|{Sender:|Receiver:}|{{ready_for_settlement}|{ready_for_settlement}}",fillcolor=red];
  2->3 [label="Sender"];

  {rank=min; 0;}
  {rank=max; 999;}

  9001 -> 0 [label = "Soft_match"];
  9002 -> 0 [label = "Soft_match"];
  9003 -> 0 [label = "need_kyc"];


}

