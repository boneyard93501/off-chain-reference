
digraph G {
  concentrate=True;
  rankdir=TB;
  node [shape=record];

# Happy path protocol
  0 [label="Start"];
  0->1 [label="Sender"]

subgraph cluster_2 {
  label = "KYC Exchange flow";
  1 [label="SINIT\n|{Sender:|Receiver:}|{{need_kyc}|{none}}"];
  1 -> 2 [ label="Receiver" ];
  2 [label="RSEND\n|{Sender:|Receiver:}|{{need_kyc}|{ready_for_settlement}}"];


}


  1 -> 4 [label="Receiver"];
  2 -> 6 [label = "Sender"];

  3->999;
  999 [label = "On-chain payment"]
  3 [label="READY\n|{Sender:|Receiver:}|{{ready_for_settlement}|{ready_for_settlement}}",fillcolor=red];
  2->3 [label="Sender"];


subgraph cluster_0 {
  label = "Receiver Soft-match (Optional)";
  4 [label = "RSOFT\n|{Sender:|Receiver:|Flags:}|{{need_kyc}|{soft_match}|{_, _}}"];

  4 -> 5 [label = "Sender"];
  5 [label = "SSOFTSEND\n|{Sender:|Receiver:|Flags:}|{{need_kyc}|{soft_match}|{Sx, _}}"];
}

  5 -> 2 [label = "Receiver"];



subgraph cluster_1 {
  label = "Sender Soft-match (Optional)";
  6 [label = "SSOFT\n|{Sender:|Receiver:|Flags:}|{{soft_match}|{ready_for_settlement}|{*, _}}"];

  6 -> 7 [label = "Receiver"];
  7 [label = "RSOFTSEND\n|{Sender:|Receiver:|Flags:}|{{soft_match}|{ready_for_settlement}|{*, Rx}}"];
}

  7 -> 3 [label = "Sender"];


}
